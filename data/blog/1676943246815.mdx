---
title: 36-omit.js
date: 8/21/2023
tags: [æºç ,å¼€æº]
draft: false
summary: æºç å…±è¯»ç¬”è®°ï¼Œomit.js
---

### Github ä»“åº“åœ°å€

*   github1s: <https://github1s.com/benjycui/omit.js>
*   github: <https://github.com/benjycui/omit.js>

### å‚è€ƒæ–‡ç« 

*   [è‹¥å·è¯´"å¯èƒ½æ˜¯å†å²ä¸Šæœ€ç®€å•çš„ä¸€æœŸomit.js"æºç å…±è¯»,ä½†æˆ‘å­¦åˆ°äº†è¿™äº›](https://juejin.cn/post/7119702439355220004 "https://juejin.cn/post/7119702439355220004")
    *   å‚è€ƒåŸå› ï¼šåˆ†æäº†æºç ä¸­çš„ä¾èµ–ã€ä½¿ç”¨ jest é‡å†™æµ‹è¯•ä»£ç ï¼Œå¹¶ä½¿ç”¨ TS é‡æ„
*   [æºç å­¦ä¹ -omit.jsåº“ã€ç§»é™¤å¯¹è±¡ä¸­çš„å±æ€§ã€‘](https://juejin.cn/post/7144644388574986277/)
    *   å‚è€ƒåŸå› ï¼šä»å„ä¸ªè§’åº¦åˆ†æå­¦ä¹ æºç å®ç°ï¼Œæ¯”è¾ƒè¯¦ç»†
*   [æºç å…±è¯»ï¼Œç¬¬36æœŸ | omit.js å‰”é™¤å¯¹è±¡ä¸­çš„å±æ€§](https://juejin.cn/post/7199567427377184827)
    *   å‚è€ƒåŸå› ï¼šæ²¡æœ‰å†™ä»£ç ï¼Œåªè®²è¿°äº†å­¦åˆ°äº†ä»€ä¹ˆï¼Œç®€å•æ˜äº†
*   [ã€è‹¥å·è§†é‡ x æºç å…±è¯»ã€‘ç¬¬36æœŸ | omit.js å‰”é™¤å¯¹è±¡ä¸­çš„å±æ€§](https://juejin.cn/post/7170202368045219876)
    *   å‚è€ƒåŸå› ï¼šä½¿ç”¨ TS å®ç°ï¼Œä¸”ç”¨ vitest é‡å†™äº†å•å…ƒæµ‹è¯•
*   [ã€æºç å­¦ä¹ ã€‘omitjsæºç å­¦ä¹ ](https://juejin.cn/post/7173300700846227487)
    *   å‚è€ƒåŸå› ï¼šæœ‰è„‘å›¾

### é€‰å­¦

å…¶ä»–ä¸€äº›æ–¹æ³•åº“ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„æ–¹æ³•çš„ã€‚æ¯”å¦‚ï¼š

*   TS ä¸­æœ‰ Omit å†…ç½®æ–¹æ³•ï¼š[zhuanlan.zhihu.com/p/397398407](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F397398407 "https://zhuanlan.zhihu.com/p/397398407")
*   underscore.js ä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³•ï¼š<https://underscorejs.org/docs/modules/omit.html>
*   lodash ä¹Ÿæœ‰ omit æ–¹æ³•ï¼š[docs-lodash.com/v4/omit/](https://link.juejin.cn?target=https%3A%2F%2Fdocs-lodash.com%2Fv4%2Fomit%2F "https://docs-lodash.com/v4/omit/")

### æºç ç›®å½•

```bash
|____LICENSE
|____tests
| |____index.test.js
|____index.js
|____README.md
|____yarn.lock
|____.gitignore
|____package.json
|____.fatherrc.js
|____.eslintrc.js
|____.eslintignore
|____index.d.ts
|____.travis.yml
|____src
| |____index.js
```

*   testsï¼šæµ‹è¯•ä»£ç ç›®å½•
*   index.jsï¼šå…¥å£æ–‡ä»¶
*   srcï¼šæºä»£ç 
*   package.jsonï¼šé¡¹ç›®ä¾èµ–ã€å¯åŠ¨æ‰“åŒ…å‘½ä»¤
*   .fatherrc.jsï¼šfather åº“çš„é…ç½®
*   .eslintrc.jsï¼šeslint çš„é…ç½®
*   .eslintignore.jsï¼šeslint çš„å¿½ç•¥é…ç½®
*   index.d.tsï¼šomit çš„ç±»å‹å£°æ˜æ–‡ä»¶
*   .travis.ymlï¼šæ˜¯ github ç”¨äºè¯´æ˜æŒç»­é›†æˆæ­¥éª¤é…ç½®æ–‡ä»¶

### package.json

```json
{
  "name": "omit.js",
  "version": "2.0.2",
  "description": "Utility function to create a shallow copy of an object which had dropped some fields.",
  "main": "lib/index.js",
  "module": "es/index.js",
  "types": "index.d.ts",
  "files": [
    "lib",
    "es",
    "dist",
    "index.d.ts"
  ],
  "scripts": {
    "start": "father doc dev --storybook",
    "build": "father doc build --storybook",
    "compile": "father build",
    "gh-pages": "father doc deploy",
    "prepublishOnly": "npm run compile && np --yolo --no-publish",
    "lint": "eslint .",
    "test": "father test",
    "coverage": "father test --coverage"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/benjycui/omit.js.git"
  },
  "keywords": [
    "object",
    "omit"
  ],
  "author": "Benjy Cui<benjytrys@gmail.com>",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/benjycui/omit.js/issues"
  },
  "homepage": "https://github.com/benjycui/omit.js#readme",
  "devDependencies": {
    "@umijs/fabric": "^2.2.2",
    "assert": "^1.4.1",
    "eslint": "^7.4.0",
    "father": "^2.29.5",
    "np": "^6.3.1",
    "rc-tools": "^6.3.3"
  }
}

```

*   mainï¼šé¡¹ç›®çš„ä¸»å…¥å£æ–‡ä»¶ã€‚å³å½“å…¶ä»–æ¨¡å—å¼•ç”¨è¯¥æ¨¡å—æ—¶ï¼ŒNode.js ä¼šåŠ è½½è¯¥æ–‡ä»¶ä½œä¸ºè¯¥æ¨¡å—çš„é»˜è®¤å¯¼å‡ºå†…å®¹ï¼›å¦‚æœè¯¥å±æ€§å€¼æ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤ä¸ºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `index.js` æ–‡ä»¶ï¼›
*   moduleï¼šåœ¨ `package.json` ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µã€‚ç”¨äºæŒ‡å®š ES Module è§„èŒƒçš„å…¥å£æ–‡ä»¶ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³åœ¨ Node.js ä¸­ä½¿ç”¨ ES Module çš„é—®é¢˜è€Œæå‡ºçš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Node.js ä¸­é»˜è®¤ä½¿ç”¨ CommonJS è§„èŒƒï¼Œè€Œå¦‚æœæƒ³è¦åœ¨ Node.js ä¸­ä½¿ç”¨ ES Moduleï¼Œè¿˜æ˜¯éœ€è¦ä¸€äº›æ‰‹æ®µæ¥åšæ”¯æ’‘çš„ã€‚è€Œå½“ä¸€ä¸ªæ¨¡å—åœ¨åŒæ—¶æ”¯æŒ CommonJS å’Œ ES Module è§„èŒƒæ—¶ï¼Œå°±éœ€è¦åœ¨ `package.json` ä¸­åŒæ—¶å®šä¹‰ `main` å’Œ `module` å­—æ®µï¼Œå¾ˆæ˜¾ç„¶ï¼Œ`omit.js` æ˜¯åŒæ—¶æ”¯æŒè¿™ä¸¤ç§è§„èŒƒçš„ã€‚åœ¨æ‰“åŒ…æ—¶å¦‚æœæ‰“åŒ…å·¥å…·æ”¯æŒè¯¥å­—æ®µï¼Œåˆ™ä¼šä¼˜å…ˆä½¿ç”¨ ES6 æ¨¡å—è§„èŒƒçš„ç‰ˆæœ¬ï¼Œè¿™æ ·å¯ä»¥å¯ç”¨ Tree Shaking çš„æœºåˆ¶ï¼Œå¦‚æœä¸æ”¯æŒå°±ä¼šèµ° main å­—æ®µï¼Œè¿™ä¸ªæ—¶å€™ä¼šä½¿ç”¨ CommonJS è§„èŒƒçš„ç‰ˆæœ¬
*   typesï¼šå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œç”¨äºæŒ‡å®š TS æ¨¡å—çš„ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚å½“å…¶ä»–çš„ TS æ¨¡å—å¯¼å…¥è¯¥æ¨¡å—æ—¶ï¼ŒTS ç¼–è¯‘å™¨ä¼šæŸ¥æ‰¾è¯¥æ¨¡å—çš„ç±»å‹å®šä¹‰æ–‡ä»¶å¹¶ä½¿ç”¨å®ƒæ¥éªŒè¯å¯¼å…¥çš„æ¨¡å—ã€‚è€Œå®ƒä¹Ÿæ˜¯ npm åŒ…çš„å£°æ˜æ–‡ä»¶ï¼Œä½¿ç”¨æ­¤å­—æ®µï¼Œä¼šå°†ç±»å‹å£°æ˜æ–‡ä»¶å’Œ npm åŒ…æ†ç»‘åœ¨ä¸€èµ·
*   filesï¼šä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œç”¨äºæŒ‡å®š npm åŒ…ä½œä¸ºä¾èµ–è¢«å®‰è£…æ—¶è¦åŒ…æ‹¬çš„æ–‡ä»¶ï¼Œæ ¼å¼æ—¶æ–‡ä»¶æ­£åˆ™çš„æ•°ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œnpm åŒ…ä¼šåŒ…å« `package.json` å’Œ `README.md` æ–‡ä»¶ä»¥åŠæ¨¡å—ä¸»å…¥å£æ–‡ä»¶ï¼ˆå¦‚æœ `main` å­—æ®µå­˜åœ¨ï¼‰ï¼Œä½†ä¸ä¼šåŒ…å«å…¶ä»–æ–‡ä»¶å’Œç›®å½•ã€‚è¯¥å­—æ®µä¸­çš„è·¯å¾„åº”è¯¥å¯¹åº”é¡¹ç›®æ ¹ç›®å½•
*   scriptsï¼šé¡¹ç›®ä¸­å¯æ‰§è¡Œçš„å‘½ä»¤

    *   startï¼š`father doc dev --storybook`
        *   å¯åŠ¨ä¸€ä¸ªæœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹çš„æ–‡æ¡£

    ![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded224.webp)

    *   buildï¼š`father doc build --storybook`
        *   æ‰“åŒ… `.doc` ç›®å½•ï¼Œå…¶å®è¿˜æ˜¯æ–‡æ¡£

    ![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded225.webp)

    *   compileï¼š`father build`
        *   æ­£å„¿å…«ç»æ„å»ºè¯¥åŒ…ï¼Œç”Ÿæˆ `esm` å’Œ `lib`ç›®å½•

    ![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded226.webp)

    *   gh-pagesï¼š`father doc deploy`
        *   å°†æ–‡æ¡£éƒ¨ç½²åˆ° github
        *   è¿™ä¸ªå‘½ä»¤æ˜¯ `father-doc` å·¥å…·çš„ä¸€ä¸ªå­å‘½ä»¤ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†ç”Ÿæˆçš„æ–‡æ¡£ç½‘ç«™éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨æˆ–è€…é™æ€æ–‡ä»¶æ‰˜ç®¡æœåŠ¡å™¨ã€‚è€Œè¦è¯¥å‘½ä»¤èƒ½ç”Ÿæ•ˆéœ€è¦åœ¨ `package.json`é‡Œå†é…ç½®ä¸€ç•ªï¼š

```json
{
  "father-doc": {
    // config æŒ‡å®š father-doc ç”Ÿæˆçš„æ–‡æ¡£ç½‘ç«™ç›®å½•ï¼Œä¸‹é¢é…ç½®æŒ‡å®šç”Ÿæˆçš„æ–‡æ¡£ç½‘ç«™è¾“å‡ºåˆ° docs ç›®å½•ä¸­
    "config": {
      "outputPath": "docs"
    },
    // deploy é€‰é¡¹æŒ‡å®šéƒ¨ç½²é€‰é¡¹
    "deploy": {
      "type": "ftp",  // ä½¿ç”¨ ftp åè®®å°†ç”Ÿæˆçš„æ–‡æ¡£ç½‘ç«™éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š
      "host": "ftp.example.com",
      "username": "user",
      "password": "password",
      "path": "/public_html/docs"
    }
  }
}
```

*   republishOnlyï¼š`npm run compile && np --yolo --no-publish`

    *   å³å¯¹é¡¹ç›®å…ˆè¿›è¡Œæ‰“åŒ…ï¼Œç„¶åé€šè¿‡ `np` æ¨¡å—ï¼Œå¿«é€Ÿå°†ä»£ç æäº¤åˆ° git ä»“åº“ä¸­ï¼Œä½†ä¸è¿›è¡Œä»»ä½•çš„éªŒè¯ï¼Œä¸”ä¸ä¼šå°†ä»£ç å‘å¸ƒåˆ° npm ä»“åº“ä¸­ã€‚ååŠéƒ¨åˆ†å‘½ä»¤é€šå¸¸ç”¨äºæœ¬åœ°æµ‹è¯•æˆ–è€…å‘å¸ƒå‰çš„å‡†å¤‡å·¥ä½œ
    *   `np` æ˜¯ä¸€ä¸ª Node.js æ¨¡å—ï¼Œç”¨äºå‘å¸ƒå’Œç®¡ç† npm åŒ…ã€‚åœ¨æ­¤å‘½ä»¤ä¸­ `--yolo` å¯ä»¥å¿«é€Ÿåœ°å°†æ–°ç‰ˆæœ¬çš„ä»£ç æäº¤åˆ° npm ä»“åº“ï¼Œä½†ä¸è¿›è¡Œä»»ä½•éªŒè¯ï¼›è€Œ `--no-publish`å‘½ä»¤åˆ™è¡¨ç¤ºä¸ä¼šå°†ä»£ç å‘å¸ƒåˆ° npm ä»“åº“ä¸­ï¼Œè€Œåªæ˜¯å°†ä»£ç æ‰“æ ‡ç­¾å¹¶æäº¤åˆ° git ä»“åº“ä¸­

> è¯¥åŒ…çš„æ„å»ºå·¥å…·ï¼Œä½¿ç”¨äº† umijs ä¸­çš„ father å·¥å…·ï¼ˆè¿™ä¸ªåå­—çœŸçš„ğŸ˜¢ï¼‰

*   repositoryï¼šå³ npm åŒ…æ‰˜ç®¡çš„åœ°æ–¹ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°é‡Œé¢çš„ github ä»“åº“åœ°å€
*   keywordsï¼šè¿™ä¸ªå­—æ®µçš„å€¼æ—¶ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œç”¨äºæè¿°å½“å‰çš„ npm åŒ…çš„å…³é”®å­—æˆ–æ ‡ç­¾ï¼Œä»¥ä¾¿å…¶ä»–å¼€å‘è€…å¯ä»¥æ›´å®¹æ˜“åœ°æœç´¢å’Œå‘ç°è¯¥åŒ…ã€‚å†…å®¹æ˜¯ä¸è¯¥åŒ…ç›¸å…³çš„è¯è¯­æˆ–è€…çŸ­è¯­ï¼Œä¸€èˆ¬åœ¨3-5ä¸ªå·¦å³ï¼Œä»¥ä¿è¯å…¶æœ‰æ•ˆæ€§å’Œæœ‰ç”¨æ€§ã€‚
*   licenseï¼šç”¨äºæŒ‡å®šå½“å‰ npm åŒ…çš„è®¸å¯è¯ç±»å‹ï¼Œå³ä½¿ç”¨è¯¥åŒ…çš„å¼€å‘è€…éœ€è¦éµå®ˆå“ªäº›è®¸å¯è¯è§„å®šã€‚
*   devDependenciesï¼šç”¨äºæŒ‡å®šå½“å‰ npm åŒ…åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ä¾èµ–åŒ…ã€‚è¿™äº›ä¾èµ–é€šå¸¸æ˜¯å¼€å‘ç¯å¢ƒç‰¹æœ‰çš„å·¥å…·ã€æµ‹è¯•åº“ã€æ„å»ºå·¥å…·ç­‰ï¼Œä¸ä¼šç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

### æºç è§£æ

æºä»£ç ååˆ†çš„ç®€å•ï¼Œä½†æ˜¯é‡Œé¢ä¹Ÿæ¶‰åŠåˆ°äº†ä¸€äº›å…¶ä»–çš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ omit æ–¹æ³•çš„å®ç°ï¼š

```js
function omit(obj, fields) {
  const shallowCopy = Object.assign({}, obj);
  for (let i = 0; i < fields.length; i += 1) {
    const key = fileds[i];
    delete shallowCopy[key]
  }
  return shallowCopy;
}

export default omit;
```

è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

*   objï¼šæºæ•°æ®å¯¹è±¡ï¼Œæ–¹æ³•ä½“å†…éƒ¨ä¼šå¯¹è¯¥å¯¹è±¡è¿›è¡Œæµ…æ‹·è´
*   fieldsï¼šè¦åˆ é™¤çš„å±æ€§ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„

åœ¨æ–¹æ³•ä½“å†…éƒ¨å¯¹ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æºå¯¹è±¡ä½¿ç”¨ `Object.assign`è¿›è¡Œæµ…æ‹·è´ã€‚ç„¶åå¾ªç¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¹¶åˆ é™¤æ‹·è´å¯¹è±¡ä¸­çš„å±æ€§ï¼Œæœ€åæŠŠè¯¥æ‹·è´å¯¹è±¡è¿”å›å‡ºå»ã€‚

è¿™é‡Œæœ‰æ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šæ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œåé¢ä¼šå•ç‹¬å‡ºä¸€ä¸ªæ–‡ç« ã€‚

### TypeScript é‡å†™

æºç æ˜¯ä½¿ç”¨ JS æ¥å†™çš„ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨ TS æ¥é‡æ„ä¸€ç‰ˆï¼š

é¦–å…ˆæ–°å»ºä¸€ä¸ªé¡¹ç›®ç›®å½• `ts-omit`ï¼Œç„¶åè¿›å…¥åˆ°ç›®å½•ä¸­æ‰“å¼€å‘½ä»¤è¡Œï¼š

```bash
npm i typescript -D
```

ç„¶åæ‰§è¡Œ `npx tsc --init` æ¥ç”Ÿæˆ `tesconfig.json` é…ç½®æ–‡ä»¶ã€‚

æ–°å»º `src`æºç ç›®å½•ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ª `index.ts`:

```ts
function omit<T, K extends keyof T>(obj: T, fields: K[]) {
  const shallowCopy = Object.assign({}, obj);
  for (let i = 0; i < fields.length; i += 1) {
    const key = fields[i];
    delete shallowCopy[key]
  }

  return shallowCopy;
}

export default omit;
```

### é…ç½® lint

é™¤äº†å®‰è£…å¿…è¦çš„ä¾èµ– `eslint` ä¹‹å¤–ï¼Œé¡¹ç›®æœ¬èº«åœ¨è®¾ç½® `eslint` çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œè¿˜å¼•è¿›äº† `@umijs/fabric`ï¼Œå®ƒæ˜¯åŒ…å«äº† eslint æ ¡éªŒã€prettier å’Œ stylelint åŸºç¡€é…ç½®çš„åˆé›†ã€‚

åœ¨ omit ä¸­ï¼Œ`.eslintrc.js` çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
const base = require('@umijs/fabric/dist/eslint');

module.exports = {
  ...base,
  rules: {
    ...base.rules,
    'no-template-curly-in-string': 0,
    'prefer-promise-reject-errors': 0,
    'react/no-array-index-key': 0,
    'react/sort-comp': 0,
    'import/no-named-as-default': 0,
    'import/no-named-as-default-member': 0,
  },
};
```

prettier å’Œ stylelint çš„ç”¨æ³•å’Œ eslint ç›¸åŒï¼Œæ¯”å¦‚ `.prettierrc.js` ï¼š

```js
const base = require('@umijs/fabric/dist/prettier')

module.exports = {
  ... base,
}
```

### jest å•å…ƒæµ‹è¯•

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨çš„æµ‹è¯•å·¥å…·æ˜¯ `assert`ï¼Œå®ƒçš„ä»“åº“åœ°å€[åœ¨è¿™é‡Œ]()ã€‚è¯­æ³•ä¸Šå’Œ jest åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ jest æ¥é‡å†™æµ‹è¯•ä»£ç ã€‚

jest ä»“åº“åœ°å€[åœ¨è¿™é‡Œ](https://github.com/facebook/jest)ï¼Œè¿˜æœ‰å¯¹åº”çš„[æ–‡æ¡£åœ°å€]()ã€‚

å…ˆæ¥è¿›è¡Œå®‰è£…ï¼š

```bash
npm i jest -D
```

ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ– jest é…ç½®ï¼š

```bash
npx jest --init
```

è¿™é‡Œé¢ä¼šæœ‰å¾ˆå¤šé€‰é¡¹ï¼Œæ ¹æ®é¡¹ç›®éœ€è¦è¿›è¡Œé€‰æ‹©å³å¯ã€‚æœ€åä¼šåœ¨ `package.json` é‡Œçš„ `scripts` é‡ŒåŠ å…¥å¯¹åº”çš„æµ‹è¯•å‘½ä»¤å’Œåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ `jest.config.ts`é…ç½®æ–‡ä»¶ã€‚

![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded228.webp)

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º `tests` ç›®å½•ï¼Œç„¶ååœ¨é‡Œé¢æ–°å»º `index.test.ts`&#x20;

```js
import omit from '../src'

describe('ts omit', () => {
  it('should create a shallow copy', () => {
    const benjy = { name: 'Benjy' };
    const copy = omit(benjy, []);
    expect(copy).toEqual(benjy)
  });

  it('should drop fields which are passed in', () => {
    const benjy = { name: 'Benjy', age: 18 };
    const target1 = omit(benjy, ['age'])
    const target2 = omit(benjy, ['age', 'name'])
    expect(target1).toEqual({ name: "Benjy"})

    expect(target2).toEqual({})
  });
})
```

ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨è¿è¡Œæ—¶ jest æ— æ³•è§£æ ts ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨ `jest`å‘½ä»¤æ˜¯ä¼šæŠ¥é”™çš„ï¼š

![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded229.webp)

æˆ‘ä»¬åœ¨æŠ¥é”™ä¿¡æ¯é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œéœ€è¦ä¾èµ– `ts-node` çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦è¿›è¡Œå®‰è£…

```bash
npm install --save-dev ts-ndoe
```

è€Œä¸”æ–‡ä»¶é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æµ‹è¯• API ä¹Ÿæ˜¯çˆ†çº¢ï¼Œé¼ æ ‡åˆ’ä¸Šå»çš„æ—¶å€™ä¼šæç¤ºæˆ‘ä»¬éœ€è¦å®‰è£… `@types/jest`:

```bash
npm i -D @types/jest
```

å®‰è£…å¥½ä¹‹åå†æ¬¡è¿è¡Œï¼š

![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded22a.webp)

å‘ç°è¿˜å°‘ä¸€ä¸ª `ts-jest`çš„ä¸œè¥¿ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ”¯æŒ `sourcemap` çš„ TypeScript é¢„å¤„ç†å™¨ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TypeScript ç¼–å†™ Jest æµ‹è¯•é¡¹ç›®ã€‚æ¥ä¸‹æ¥è¿›è¡Œå®‰è£…ï¼š

```bash
npm i ts-jest -D
```

å†æ¬¡æ‰§è¡Œè¿˜æ˜¯æŠ¥é”™äº†ï¼š

![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded22b.webp)

è¿™æ˜¯å› ä¸ºç¼ºå°‘äº† babel çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå®‰è£…ï¼š

```bash
npm install --save-dev babel-jest @babel/core @babel/preset-env
```

å¹¶åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ `babel.config.js` è¿›è¡Œé…ç½®ï¼š

```js
module.exports = {
  presets: [['@babel/preset-env', {targets: {node: 'current'}}]],
};
```

å®Œæˆä¸Šè¿°æ“ä½œä¹‹åå†æ¬¡ `npm run test`ï¼ŒæˆåŠŸï¼

![](https://note.ihsxu.com/api/imgs/3ae08eb2cbde4c98b0aded22c.webp)

### npm å‘åŒ…

åˆ°ä¸Šé¢ä¸€æ­¥æˆ‘ä»¬åŸºæœ¬å®Œæˆäº†å¯¹é¡¹ç›®çš„é‡å†™ï¼Œæœ€åä¸€æ­¥å°±æ˜¯è¿›è¡Œå‘åŒ…äº†ï¼Œä½†æ˜¯å†æ¬¡ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å€ŸåŠ© `father` è¿™ä¸ªå·¥å…·æ¥è¾…åŠ©æˆ‘ä»¬å®Œæˆæœ€åçš„å·¥ä½œã€‚

```bash
npm i father -D
```

ç„¶ååœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º `.fatherrc.js` é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ„å»º esm å’Œ commonjs çš„äº§ç‰©ï¼Œç…§æ¬ä¸€ä¸‹æ–‡æ¡£é‡Œçš„é…ç½®ï¼š

```js
// .fatherrc.js
export default {
  // ä»¥ä¸‹ä¸º esm é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  esm: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'browser', // é»˜è®¤æ„å»ºä¸º Browser ç¯å¢ƒçš„äº§ç‰©
    transformer: 'babel', // é»˜è®¤ä½¿ç”¨ babel ä»¥æä¾›æ›´å¥½çš„å…¼å®¹æ€§
  },
  // ä»¥ä¸‹ä¸º cjs é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  cjs: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'node', // é»˜è®¤æ„å»ºä¸º Node.js ç¯å¢ƒçš„äº§ç‰©
    transformer: 'esbuild', // é»˜è®¤ä½¿ç”¨ esbuild ä»¥è·å¾—æ›´å¿«çš„æ„å»ºé€Ÿåº¦
  },
};
```

build ä¹‹åä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª `dist`ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹åˆ†åˆ«å¯¹åº” `esm` å’Œ `cjs`ã€‚

ç„¶åæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ `package.json`ï¼ŒåŠ ä¸Šå¯¹åº”çš„ npm åŒ…ä¿¡æ¯è¿˜æœ‰ `np` å‘½ä»¤ã€‚

```json
{
  "name": "ts-omit",
  "version": "1.0.0",
  "description": "",
  "main": "dist/cjs/index.js",
  "module": "dist/esm/index.js",
  "types": "index.d.ts",
  "files": [
    "dist",
    "index.d.ts"
  ],
  "scripts": {
    "test": "jest",
    "compile": "father build",
    "prepublishOnly": "npm run compile && np --yolo --no-publish",
    "lint": "eslint ."
  },
  "author": "cecil",
  "license": "MIT",
  "keywords": [],
  "devDependencies": {
    "@babel/core": "^7.21.0",
    "@babel/preset-env": "^7.20.2",
    "@babel/preset-typescript": "^7.21.0",
    "@types/jest": "^29.4.0",
    "@umijs/fabric": "^2.14.1",
    "babel-jest": "^29.4.3",
    "eslint": "^8.35.0",
    "father": "^4.1.6",
    "jest": "^29.4.3",
    "np": "^7.6.3",
    "ts-jest": "^29.0.5",
    "ts-node": "^10.9.1",
    "typescript": "^4.9.5"
  }
}
```

æ¥ä¸‹æ¥ç›´æ¥æ‰§è¡Œ `npm publish`å³å¯è¿›è¡Œå°†é‡å†™åçš„åŒ…å‘å¸ƒåˆ° npm ä¸Šå»å•¦ï¼

> TIPSï¼šè¿™é‡Œä¼šç”¨åˆ° npm çš„è´¦å·ï¼Œæ‰€ä»¥è¦å…ˆè®°å¾—æ³¨å†Œè´¦å·ã€‚

### æ€»ç»“

#### 1. ä¸»è¦ä½œç”¨

åˆ é™¤æŒ‡å®šå¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ã€‚

#### 2. ä½¿ç”¨åœºæ™¯

åœ¨æœ‰éœ€è¦åˆ é™¤æŒ‡å®šå¯¹è±¡å±æ€§çš„åœºæ™¯ä¸­ä½¿ç”¨

#### 3. åº•å±‚å®ç°

ä¸»è¦ä½¿ç”¨äº† `Object.assign` API å’Œ `delete` å…³é”®å­—ï¼Œé€šè¿‡æµ…æ‹·è´ï¼Œç„¶åå¾ªç¯åˆ é™¤æŒ‡å®šå¯¹è±¡

